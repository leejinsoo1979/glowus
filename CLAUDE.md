# CLAUDE.md

Claude Code ê°œë°œ ê°€ì´ë“œ - GlowUS AI Workforce OS

---

## 0. í”„ë¡œì íŠ¸ ì •ì²´ì„±

### í•œ ì¤„ ì •ì˜

> **"ì¡°ì§ì²˜ëŸ¼ ì¼í•˜ëŠ” AI ì—ì´ì „íŠ¸ ì½”ì›Œí‚¹ OS"**

### ìŠ¬ë¡œê±´

> **"ë‹¹ì‹ ì„ ìœ„í•´ ì¼í•˜ëŠ” AI íšŒì‚¬ í•œ ì±„"**

### í¬ì§€ì…”ë‹: ìš°ë¦¬ëŠ” í”„ë ˆì„ì›Œí¬ê°€ ì•„ë‹ˆë‹¤

| êµ¬ë¶„ | ì¼ë°˜ ì—ì´ì „íŠ¸ í”Œë«í¼ | GlowUS |
|------|---------------------|--------|
| ë¹„ìœ  | í”„ë¦¬ëœì„œ ë‹¨í†¡ë°© | AI íšŒì‚¬ í•œ ì±„ |
| êµ¬ì¡° | íŒŒì´í”„ë¼ì¸ | ì¡°ì§ ìš´ì˜ ì‹œìŠ¤í…œ |
| ê¸°ì–µ | ì—†ìŒ/ì„¸ì…˜ ë‹¨ìœ„ | ê³µìœ  + ê°œì¸ ë©”ëª¨ë¦¬ |
| ì—­í•  | íƒœìŠ¤í¬ ë¶„ë‹´ | ì§ì±…/ì§ë¬´ |
| í†µì œ | ì—†ìŒ | ê¶Œí•œ/ê°ì‚¬/ìŠ¹ì¸ |
| ì„±ì¥ | ì—†ìŒ | ì„±ê³¼ ëˆ„ì /ë ˆë²¨ì—… |

### ê²½ìŸì‚¬ ëŒ€ë¹„ ë ˆë²¨

```
âŒ AutoGPT / CrewAI / LangGraph / AutoGen
   â†’ "ì—ì´ì „íŠ¸ í”„ë ˆì„ì›Œí¬" (íŒŒì´í”„ë¼ì¸ ìˆ˜ì¤€)

âœ… GlowUS
   â†’ "ì—ì´ì „íŠ¸ ì¡°ì§ ìš´ì˜ ì‹œìŠ¤í…œ" (íšŒì‚¬ ìš´ì˜ ìˆ˜ì¤€)
```

**í•µì‹¬ ì°¨ë³„ì :**
- ğŸ‘” **ì—­í• ì´ ìˆë‹¤** (CMO, ë¦¬ì„œì²˜, ê°œë°œì ë“± ì§ì±…)
- ğŸ§  **ê¸°ì–µì´ ê³µìœ ëœë‹¤** (5ê³„ì¸µ ë©”ëª¨ë¦¬: Private/Meeting/Team/Injected/Execution)
- ğŸ“Š **ì„±ê³¼ê°€ ëˆ„ì ëœë‹¤** (ëŠ¥ë ¥ì¹˜ ì„±ì¥, ì‚¬ìš© í†µê³„)
- ğŸ§¾ **ëª¨ë“  í–‰ë™ì´ ê¸°ë¡Â·í†µì œëœë‹¤** (ê°ì‚¬ ë¡œê·¸, ìŠ¹ì¸ ê²Œì´íŠ¸)
- ğŸ¢ **"íšŒì‚¬ì²˜ëŸ¼" êµ´ëŸ¬ê°„ë‹¤** (ERP + íŒ€ + ìƒì‚¬ êµ¬ì¡°)

### ë§ˆì¼€íŒ…ìš© í‘œí˜„

| ìš©ë„ | í‘œí˜„ |
|------|------|
| ê°€ë³ê²Œ | AI ì—ì´ì „íŠ¸ ì½”ì›Œí‚¹ ì‹œìŠ¤í…œ |
| ì œëŒ€ë¡œ | ì¡°ì§ì²˜ëŸ¼ ì¼í•˜ëŠ” AI ì—ì´ì „íŠ¸ ì½”ì›Œí‚¹ OS |
| í•œ ë°©ì— | ë‹¹ì‹ ì„ ìœ„í•´ ì¼í•˜ëŠ” AI íšŒì‚¬ í•œ ì±„ |

âš ï¸ **ì£¼ì˜**: "ì—ì´ì „íŠ¸ í”Œë«í¼"ì´ë¼ê³ ë§Œ ë§í•˜ë©´ LangGraph, CrewAI, AutoGenê³¼ ê°™ì€ ì¤„ì— ì„œê²Œ ëœë‹¤. ìš°ë¦¬ëŠ” ê·¸ ìœ„ì— ìˆë‹¤.

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

**GlowUS**ëŠ” ì¡°ì§ìš© AI Workforce OSì…ë‹ˆë‹¤. AIë¥¼ "ë””ì§€í„¸ ì§ì›"ìœ¼ë¡œ ì·¨ê¸‰í•˜ë©°, ë©”ëª¨ë¦¬Â·ì„±ì¥Â·ê¶Œí•œ ì‹œìŠ¤í…œì„ ê°–ì¶˜ AI ì¡°ì§ ìš´ì˜ í”Œë«í¼ì…ë‹ˆë‹¤.

### í•µì‹¬ ì² í•™
```
AI = "ë„êµ¬" â†’ AI = "ì¡°ì§ì˜ ì¸ë ¥"
ì—°ë™ = "ê¸°ëŠ¥" â†’ ì—°ë™ = "ì§ì›ì˜ ìŠ¤í‚¬"
ëª¨ë¸ ê²½ìŸ â†’ ëª¨ë¸ ìœ„ì˜ OS ë ˆì´ì–´
```

### 4ëŒ€ ì½”ì–´ ì—”ì§„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AI Agent OS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ 1. Identity  â”‚  â”‚ 2. Skill OS  â”‚                 â”‚
â”‚  â”‚    & Growth  â”‚  â”‚              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ 3. Workflow  â”‚  â”‚ 4. Governanceâ”‚                 â”‚
â”‚  â”‚    Compiler  â”‚  â”‚    & Trust   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ì—”ì§„ | ìœ„ì¹˜ | ê¸°ëŠ¥ |
|------|------|------|
| **Identity & Growth** | `lib/memory/` | 5ê³„ì¸µ ë©”ëª¨ë¦¬, ê´€ê³„, ëŠ¥ë ¥ì¹˜ ì„±ì¥ |
| **Skill OS** | `lib/ai/super-agent-tools.ts` | 50+ ë„êµ¬, LangChain DynamicStructuredTool |
| **Workflow Compiler** | `lib/ai/workflow-tools.ts` | Planner â†’ Compiler â†’ Runner â†’ Reporter |
| **Governance** | `lib/agent/permissions.ts` | ê¶Œí•œ, ìŠ¹ì¸ ê²Œì´íŠ¸, ê°ì‚¬ ë¡œê·¸ |

---

## 2. ê°œë°œ ëª…ë ¹ì–´

```bash
# ê¸°ë³¸ ê°œë°œ
npm run dev              # Next.js ê°œë°œ ì„œë²„ (í¬íŠ¸ 3000)
npm run dev:turbo        # Turbo ëª¨ë“œ
npm run dev:full         # Dev + Stagehand ë¸Œë¼ìš°ì € ìë™í™”

# Electron ë°ìŠ¤í¬í†±
npm run electron:dev     # ì „ì²´ Electron í™˜ê²½
npm run electron:pack    # í”„ë¡œë•ì…˜ ë¹Œë“œ

# í’ˆì§ˆ ê²€ì‚¬
npm run lint             # ESLint
npm run typecheck        # TypeScript íƒ€ì… ì²´í¬ (tsc --noEmit)
npm run test             # Jest í…ŒìŠ¤íŠ¸

# MCP/Claude ì„œë²„
npm run mcp:neural-map-ws  # Neural Map WebSocket
npm run claude-bridge      # Claude Bridge ì„œë²„
npm run jarvis             # Jarvis ì„œë²„
```

**Node.js**: v20.0.0 ~ v22.x

---

## 3. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
app/
â”œâ”€â”€ api/                     # API ë¼ìš°íŠ¸
â”‚   â”œâ”€â”€ agents/[id]/         # ì—ì´ì „íŠ¸ CRUD
â”‚   â”œâ”€â”€ chat/rooms/          # ì±„íŒ…ë°©
â”‚   â”œâ”€â”€ projects/[id]/       # í”„ë¡œì íŠ¸
â”‚   â””â”€â”€ webhooks/telegram/   # í…”ë ˆê·¸ë¨ ì›¹í›…
â”œâ”€â”€ dashboard-group/         # ë©”ì¸ ì•±
â”‚   â”œâ”€â”€ agents/              # ì—ì´ì „íŠ¸ ê´€ë¦¬
â”‚   â”œâ”€â”€ messenger/           # íŒ€ ë©”ì‹ ì €
â”‚   â”œâ”€â”€ apps/                # AI ì•± (docs, sheet, slides)
â”‚   â””â”€â”€ ai-coding/           # AI ì½”ë”© í™˜ê²½

lib/
â”œâ”€â”€ ai/                      # Super Agent ë„êµ¬
â”œâ”€â”€ agent/                   # ì—ì´ì „íŠ¸ ì‹¤í–‰ê¸°
â”œâ”€â”€ memory/                  # 5ê³„ì¸µ ë©”ëª¨ë¦¬
â”œâ”€â”€ neural-map/              # ì§€ì‹ ê·¸ë˜í”„
â”œâ”€â”€ supabase/                # DB í´ë¼ì´ì–¸íŠ¸
â””â”€â”€ integrations/            # ì™¸ë¶€ ì—°ë™

components/
â”œâ”€â”€ neural-map/              # 3D ì§€ì‹ ê·¸ë˜í”„
â”œâ”€â”€ chat/                    # ì±„íŒ… UI
â””â”€â”€ glow-code/               # Glow Code

stores/
â”œâ”€â”€ authStore.ts             # ì¸ì¦
â”œâ”€â”€ chatStore.ts             # ì±„íŒ…
â”œâ”€â”€ uiStore.ts               # UI
â””â”€â”€ glowCodeStore.ts         # Glow Code

server/
â”œâ”€â”€ terminal-server.js       # í„°ë¯¸ë„ WebSocket
â”œâ”€â”€ claude-bridge-server.js  # Claude ë¸Œë¦¿ì§€
â””â”€â”€ jarvis-server.js         # Jarvis
```

---

## 4. í•µì‹¬ íƒ€ì… ì •ì˜

### ì—ì´ì „íŠ¸ íƒ€ì…
```typescript
// types/database.ts
export type AgentStatus = 'ACTIVE' | 'INACTIVE' | 'BUSY' | 'ERROR'
export type InteractionMode = 'solo' | 'sequential' | 'debate' | 'collaborate' | 'supervisor'

export interface DeployedAgent {
  id: string
  name: string
  description: string | null
  owner_id: string
  team_id: string | null
  capabilities: string[]
  status: AgentStatus
  system_prompt: string | null
  model: string
  temperature: number
  interaction_mode: InteractionMode
  next_agent_id: string | null      // ì²´ì´ë‹
  chain_config: ChainConfig | null
  voice_settings: VoiceSettings | null
  created_at: string
  updated_at: string
}
```

### ë©”ëª¨ë¦¬ íƒ€ì…
```typescript
// lib/memory/agent-memory-service.ts
export type AgentMemoryType = 'private' | 'meeting' | 'team' | 'injected' | 'execution'

export interface AgentMemory {
  id: string
  agent_id: string
  memory_type: AgentMemoryType
  relationship_id?: string | null   // private ë©”ëª¨ë¦¬ìš©
  meeting_id?: string | null        // meeting ë©”ëª¨ë¦¬ìš©
  team_id?: string | null           // team ë©”ëª¨ë¦¬ìš©
  workflow_run_id?: string | null   // execution ë©”ëª¨ë¦¬ìš©
  raw_content: string
  summary?: string | null
  importance: number                // 1-10
  embedding?: number[] | null       // ë²¡í„° ì„ë² ë”©
  tags: string[]
  metadata: Record<string, any>
  created_at: string
}
```

### í”„ë¡œì íŠ¸/íƒœìŠ¤í¬ íƒ€ì…
```typescript
export type ProjectStatus = 'planning' | 'active' | 'on_hold' | 'completed' | 'cancelled'
export type ProjectTaskStatus = 'TODO' | 'IN_PROGRESS' | 'REVIEW' | 'DONE' | 'CANCELLED'
export type AssigneeType = 'human' | 'agent'

export interface ProjectTask {
  id: string
  project_id: string
  title: string
  status: ProjectTaskStatus
  assignee_type: AssigneeType | null
  assignee_user_id: string | null
  assignee_agent_id: string | null
  depends_on: string[]              // DAG ì˜ì¡´ì„±
  agent_result: Record<string, unknown> | null
  agent_executed_at: string | null
}
```

---

## 5. API ì‘ë‹µ íŒ¨í„´

### í‘œì¤€ ì‘ë‹µ í˜•ì‹
```typescript
// ì„±ê³µ
return NextResponse.json({
  success: true,
  data: result
})

// ì—ëŸ¬
return NextResponse.json(
  { error: 'ì—ëŸ¬ ë©”ì‹œì§€' },
  { status: 400 | 401 | 404 | 500 }
)

// í˜ì´ì§€ë„¤ì´ì…˜
return NextResponse.json({
  data: items,
  total: count,
  page: currentPage,
  limit: pageSize
})
```

### API ë¼ìš°íŠ¸ í…œí”Œë¦¿
```typescript
// app/api/[resource]/route.ts
export const dynamic = 'force-dynamic'
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@/lib/supabase/server'
import { createAdminClient } from '@/lib/supabase/admin'

export async function GET(request: NextRequest) {
  try {
    const supabase = await createClient()
    const { data: { user } } = await supabase.auth.getUser()

    if (!user) {
      return NextResponse.json({ error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤' }, { status: 401 })
    }

    const adminClient = createAdminClient()
    const { data, error } = await (adminClient as any)
      .from('table_name')
      .select('*')
      .eq('owner_id', user.id)

    if (error) {
      return NextResponse.json({ error: error.message }, { status: 500 })
    }

    return NextResponse.json(data)
  } catch (error) {
    console.error('[API] Error:', error)
    return NextResponse.json({ error: String(error) }, { status: 500 })
  }
}
```

---

## 6. ë„êµ¬ ì •ì˜ íŒ¨í„´

### LangChain DynamicStructuredTool
```typescript
// lib/agent/tools.ts
import { DynamicStructuredTool } from '@langchain/core/tools'
import { z } from 'zod'

export const webSearchTool = new DynamicStructuredTool({
  name: 'web_search',
  description: 'ì›¹ì—ì„œ ì •ë³´ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.',
  schema: z.object({
    query: z.string().describe('ê²€ìƒ‰í•  í‚¤ì›Œë“œ'),
    maxResults: z.number().optional().default(5),
  }),
  func: async ({ query, maxResults = 5 }) => {
    try {
      const response = await tavilyClient.search(query, { maxResults })
      return JSON.stringify({
        answer: response.answer,
        results: response.results.map(r => ({
          title: r.title,
          url: r.url,
          content: r.content?.slice(0, 500),
        })),
      })
    } catch (error) {
      return JSON.stringify({ error: `ê²€ìƒ‰ ì‹¤íŒ¨: ${error}` })
    }
  },
})
```

### Super Agent ë„êµ¬ íƒ€ì…
```typescript
// lib/ai/super-agent-tools.ts
export type SuperAgentToolName =
  | 'create_project' | 'read_file' | 'write_file' | 'edit_file'
  | 'web_search' | 'generate_image' | 'create_task'
  | 'navigate_to' | 'use_skill' | 'call_agent'
  | 'create_node' | 'update_node' | 'delete_node'
  | 'browser_automation' | 'use_claude_code'

export interface ToolExecutionResult {
  success: boolean
  result?: unknown
  error?: string
  action?: ToolAction  // í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰ìš©
}
```

---

## 7. ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ íŒ¨í„´

### 5ê³„ì¸µ ë©”ëª¨ë¦¬ ì €ì¥
```typescript
import { saveAgentMemory, savePrivateMemory, saveMeetingMemory } from '@/lib/memory/agent-memory-service'

// Private ë©”ëª¨ë¦¬ (1:1 ëŒ€í™”)
await savePrivateMemory({
  agentId: 'agent-uuid',
  relationshipId: 'user-uuid',
  content: 'ì‚¬ìš©ìê°€ Reactë¥¼ ì„ í˜¸í•œë‹¤ê³  ë§í•¨',
  importance: 7,
  tags: ['preference', 'tech'],
})

// Meeting ë©”ëª¨ë¦¬ (íšŒì˜)
await saveMeetingMemory({
  agentId: 'agent-uuid',
  meetingId: 'meeting-uuid',
  roomId: 'room-uuid',
  content: 'í”„ë¡œì íŠ¸ ë§ˆê°ì¼ 12ì›” 15ì¼ë¡œ ê²°ì •',
  importance: 9,
})

// Execution ë©”ëª¨ë¦¬ (ì›Œí¬í”Œë¡œìš° ê²°ê³¼)
await saveAgentMemory({
  agentId: 'agent-uuid',
  memoryType: 'execution',
  workflowRunId: 'run-uuid',
  content: 'ë¦¬í¬íŠ¸ ìƒì„± ì„±ê³µ, ìŠ¬ë™ ì „ì†¡ ì™„ë£Œ',
  metadata: { cost: 0.12, duration_ms: 3500 },
})
```

### ë©”ëª¨ë¦¬ ê²€ìƒ‰ (RAG)
```typescript
import { searchAgentMemories } from '@/lib/memory/agent-memory-service'

const memories = await searchAgentMemories({
  agentId: 'agent-uuid',
  query: 'React í”„ë¡œì íŠ¸',
  memoryTypes: ['private', 'team'],
  useSemanticSearch: true,
  similarityThreshold: 0.7,
  limit: 10,
})
```

---

## 8. Supabase íŒ¨í„´

### í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
```typescript
// ì„œë²„ ì»´í¬ë„ŒíŠ¸/API
import { createClient } from '@/lib/supabase/server'
const supabase = await createClient()

// Admin (RLS ìš°íšŒ)
import { createAdminClient } from '@/lib/supabase/admin'
const adminClient = createAdminClient()

// í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸
import { createClient } from '@/lib/supabase/client'
const supabase = createClient()
```

### ì¿¼ë¦¬ íŒ¨í„´
```typescript
// Select with relations
const { data, error } = await (adminClient as any)
  .from('deployed_agents')
  .select(`
    *,
    next_agent:next_agent_id(id, name, avatar_url),
    team:team_id(id, name)
  `)
  .eq('owner_id', user.id)
  .order('created_at', { ascending: false })

// Upsert
const { data, error } = await supabase
  .from('agent_identity')
  .upsert({
    agent_id: agentId,
    core_values: ['honesty', 'efficiency'],
    personality_traits: { openness: 0.8, conscientiousness: 0.9 },
  })
  .select()
  .single()

// RPC (ë²¡í„° ê²€ìƒ‰)
const { data } = await adminClient.rpc('match_agent_memories', {
  query_embedding: embedding,
  match_threshold: 0.7,
  match_count: 10,
  filter_agent_id: agentId,
})
```

---

## 9. ìƒíƒœ ê´€ë¦¬ íŒ¨í„´

### Zustand ìŠ¤í† ì–´
```typescript
// stores/chatStore.ts
import { create } from 'zustand'

interface ChatState {
  messages: Message[]
  isLoading: boolean
  addMessage: (message: Message) => void
  setLoading: (loading: boolean) => void
}

export const useChatStore = create<ChatState>((set) => ({
  messages: [],
  isLoading: false,
  addMessage: (message) =>
    set((state) => ({ messages: [...state.messages, message] })),
  setLoading: (loading) => set({ isLoading: loading }),
}))
```

### React Query
```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'

// ì¡°íšŒ
const { data: agents, isLoading } = useQuery({
  queryKey: ['agents', teamId],
  queryFn: () => fetch(`/api/agents?team_id=${teamId}`).then(r => r.json()),
})

// ìˆ˜ì •
const queryClient = useQueryClient()
const mutation = useMutation({
  mutationFn: (data) => fetch('/api/agents', {
    method: 'POST',
    body: JSON.stringify(data),
  }),
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['agents'] })
  },
})
```

---

## 10. ì—ëŸ¬ í•¸ë“¤ë§

### API ì—ëŸ¬ íŒ¨í„´
```typescript
// ì—ëŸ¬ ì‘ë‹µ ìƒìˆ˜
const ERRORS = {
  UNAUTHORIZED: { error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤', status: 401 },
  NOT_FOUND: { error: 'ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', status: 404 },
  FORBIDDEN: { error: 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤', status: 403 },
}

// Supabase ì—ëŸ¬ ì²˜ë¦¬
if (error) {
  if (error.code === 'PGRST116') {
    return NextResponse.json({ error: 'ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' }, { status: 404 })
  }
  if (error.code === '23505') {
    return NextResponse.json({ error: 'ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤' }, { status: 409 })
  }
  return NextResponse.json({ error: error.message }, { status: 500 })
}
```

### ë„êµ¬ ì—ëŸ¬ íŒ¨í„´
```typescript
// ë„êµ¬ ì‹¤í–‰ ê²°ê³¼
interface ToolResult {
  success: boolean
  result?: unknown
  error?: string
}

// ë„êµ¬ ë‚´ë¶€
try {
  const result = await someOperation()
  return JSON.stringify({ success: true, result })
} catch (error) {
  console.error('[Tool] Error:', error)
  return JSON.stringify({ success: false, error: String(error) })
}
```

---

## 11. SSE ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ íŒ¨í„´

AI ì±„íŒ…ì—ì„œ ì‹¤ì‹œê°„ ì‘ë‹µì„ ìœ„í•œ Server-Sent Events íŒ¨í„´.

```typescript
// app/api/agents/[id]/chat/stream/route.ts
export const dynamic = 'force-dynamic'
import { NextRequest } from 'next/server'

export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  const encoder = new TextEncoder()
  const { id: agentId } = await params

  // ì¸ì¦ ì²´í¬
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    return new Response(
      encoder.encode(`data: ${JSON.stringify({ type: 'error', error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤' })}\n\n`),
      {
        status: 401,
        headers: {
          'Content-Type': 'text/event-stream',
          'Cache-Control': 'no-cache',
          'Connection': 'keep-alive',
        },
      }
    )
  }

  // SSE ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
  const readable = new ReadableStream({
    async start(controller) {
      try {
        // AI ì‘ë‹µ ìƒì„±ê¸°
        const generator = generateSuperAgentResponseStream(agent, message, history)

        for await (const event of generator) {
          const data = `data: ${JSON.stringify(event)}\n\n`
          controller.enqueue(encoder.encode(data))

          if (event.type === 'done') break
        }

        controller.close()
      } catch (error) {
        controller.enqueue(
          encoder.encode(`data: ${JSON.stringify({ type: 'error', error: String(error) })}\n\n`)
        )
        controller.close()
      }
    },
  })

  return new Response(readable, {
    headers: {
      'Content-Type': 'text/event-stream',
      'Cache-Control': 'no-cache',
      'Connection': 'keep-alive',
    },
  })
}
```

### í”„ë¡ íŠ¸ì—”ë“œ SSE ì†Œë¹„
```typescript
const response = await fetch(`/api/agents/${agentId}/chat/stream`, {
  method: 'POST',
  body: JSON.stringify({ message, conversation_history }),
})

const reader = response.body?.getReader()
const decoder = new TextDecoder()

while (true) {
  const { done, value } = await reader!.read()
  if (done) break

  const chunk = decoder.decode(value)
  const lines = chunk.split('\n').filter(line => line.startsWith('data: '))

  for (const line of lines) {
    const event = JSON.parse(line.slice(6))  // 'data: ' ì œê±°

    if (event.type === 'text') {
      setResponse(prev => prev + event.content)
    } else if (event.type === 'tool_start') {
      setCurrentTool(event.tool?.name)
    } else if (event.type === 'done') {
      setIsLoading(false)
    }
  }
}
```

---

## 12. ì›¹í›… ì²˜ë¦¬ íŒ¨í„´

### Telegram ì›¹í›…
```typescript
// app/api/integrations/telegram/webhook/route.ts
export const dynamic = 'force-dynamic'

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    const { message, callback_query } = body

    // ë©”ì‹œì§€ ì²˜ë¦¬
    if (message?.text) {
      const chatId = message.chat.id
      const text = message.text
      const userId = message.from.id.toString()

      // ì—ì´ì „íŠ¸ ì‘ë‹µ ìƒì„±
      const response = await executeWithAutonomousLoop({
        instruction: text,
        agentId: 'default-agent-id',
        userId,
      })

      // í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì‘ë‹µ ì „ì†¡
      await sendTelegramMessage(chatId, response)
    }

    // ì½œë°± ì¿¼ë¦¬ ì²˜ë¦¬ (ì¸ë¼ì¸ ë²„íŠ¼)
    if (callback_query) {
      const callbackData = callback_query.data
      await handleCallbackQuery(callback_query.id, callbackData)
    }

    return NextResponse.json({ ok: true })
  } catch (error) {
    console.error('[Telegram Webhook] Error:', error)
    return NextResponse.json({ ok: true })  // ì—ëŸ¬ë„ 200 ë°˜í™˜ (ì¬ì‹œë„ ë°©ì§€)
  }
}

// í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ ì „ì†¡
async function sendTelegramMessage(chatId: number, text: string) {
  await fetch(`https://api.telegram.org/bot${process.env.TELEGRAM_BOT_TOKEN}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: chatId,
      text,
      parse_mode: 'Markdown',
    }),
  })
}
```

### GitHub ì›¹í›…
```typescript
// app/api/github/webhook/route.ts
export async function POST(request: NextRequest) {
  const signature = request.headers.get('x-hub-signature-256')
  const body = await request.text()

  // ì‹œê·¸ë‹ˆì²˜ ê²€ì¦
  const isValid = verifyGitHubSignature(body, signature)
  if (!isValid) {
    return NextResponse.json({ error: 'Invalid signature' }, { status: 401 })
  }

  const event = request.headers.get('x-github-event')
  const payload = JSON.parse(body)

  switch (event) {
    case 'push':
      await handlePushEvent(payload)
      break
    case 'pull_request':
      await handlePullRequestEvent(payload)
      break
    case 'issues':
      await handleIssuesEvent(payload)
      break
  }

  return NextResponse.json({ received: true })
}
```

---

## 13. íŒŒì¼ ì—…ë¡œë“œ íŒ¨í„´

### Supabase Storage ì—…ë¡œë“œ
```typescript
// app/api/chat/upload/route.ts
export async function POST(request: NextRequest) {
  const supabase = await createClient()
  const adminClient = createAdminClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  const formData = await request.formData()
  const file = formData.get('file') as File
  const roomId = formData.get('roomId') as string

  // íŒŒì¼ íƒ€ì… ê²€ì¦
  const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf']
  if (!allowedTypes.includes(file.type)) {
    return NextResponse.json({ error: 'ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤' }, { status: 400 })
  }

  // íŒŒì¼ í¬ê¸° ì œí•œ (50MB)
  const maxSize = 50 * 1024 * 1024
  if (file.size > maxSize) {
    return NextResponse.json({ error: 'íŒŒì¼ í¬ê¸°ëŠ” 50MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤' }, { status: 400 })
  }

  // íŒŒì¼ëª… ìƒì„±
  const fileExt = file.name.split('.').pop()
  const fileName = `${roomId}/${user.id}/${Date.now()}.${fileExt}`
  const bucket = 'chat-files'

  // ArrayBufferë¡œ ë³€í™˜
  const arrayBuffer = await file.arrayBuffer()
  const buffer = new Uint8Array(arrayBuffer)

  // Storage ì—…ë¡œë“œ
  const { data: uploadData, error: uploadError } = await (adminClient as any).storage
    .from(bucket)
    .upload(fileName, buffer, {
      contentType: file.type,
      upsert: false,
    })

  if (uploadError) {
    return NextResponse.json({ error: uploadError.message }, { status: 500 })
  }

  // Public URL ê°€ì ¸ì˜¤ê¸°
  const { data: { publicUrl } } = (adminClient as any).storage
    .from(bucket)
    .getPublicUrl(fileName)

  return NextResponse.json({
    url: publicUrl,
    fileName: file.name,
    fileSize: file.size,
    fileType: file.type,
  })
}
```

### Storage íŒŒì¼ ì‚­ì œ
```typescript
const { error } = await adminClient.storage
  .from('chat-files')
  .remove([`${roomId}/${userId}/${fileName}`])
```

### Storage íŒŒì¼ ëª©ë¡ ì¡°íšŒ
```typescript
const { data, error } = await adminClient.storage
  .from('chat-files')
  .list(`${roomId}/${userId}`, {
    limit: 100,
    sortBy: { column: 'created_at', order: 'desc' },
  })
```

---

## 14. í™˜ê²½ ë³€ìˆ˜

```env
# í•„ìˆ˜
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
OPENAI_API_KEY=

# LLM í”„ë¡œë°”ì´ë”
ANTHROPIC_API_KEY=
GOOGLE_GENERATIVE_AI_API_KEY=
DEEPSEEK_API_KEY=
GROQ_API_KEY=

# ê²€ìƒ‰/ì—°ë™
TAVILY_API_KEY=
TELEGRAM_BOT_TOKEN=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
```

---

## 15. í¬ë ˆë”§/ê³¼ê¸ˆ ì‹œìŠ¤í…œ íŒ¨í„´

```typescript
import { checkCredits, deductCredits } from '@/lib/credits'

// í¬ë ˆë”§ í™•ì¸
const creditCheck = await checkCredits(userId, requiredCredits)
if (!creditCheck.canUse) {
  return NextResponse.json({
    error: 'í¬ë ˆë”§ì´ ë¶€ì¡±í•©ë‹ˆë‹¤',
    code: 'INSUFFICIENT_CREDITS',
    required: requiredCredits,
    balance: creditCheck.balance + creditCheck.dailyBalance,
  }, { status: 402 })
}

// í¬ë ˆë”§ ì°¨ê° (ë¹„ë™ê¸°)
deductCredits(userId, creditCost, {
  description: `ì—ì´ì „íŠ¸ ì±„íŒ…: ${agentName}`,
  action: 'chat_gpt4o',
}).then(result => {
  console.log(`Credits charged: ${creditCost}, remaining: ${result.balance}`)
})
```

---

## 16. ë¹„ë™ê¸° í›„ì²˜ë¦¬ íŒ¨í„´

ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ í›„ ë©”ëª¨ë¦¬ ì €ì¥, í•™ìŠµ ë“± í›„ì²˜ë¦¬.

```typescript
// ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í›„ ë¹„ë™ê¸° ì²˜ë¦¬
if (streamSuccess && finalResponse) {
  // 1. í¬ë ˆë”§ ì°¨ê°
  if (!useUserKey && creditCost > 0) {
    deductCredits(userId, creditCost, { description: 'ì±„íŒ…' })
      .catch(err => console.error('Credit error:', err))
  }

  // 2. ë©”ëª¨ë¦¬ ì €ì¥ (ë³‘ë ¬)
  Promise.all([
    saveConversationMessage({
      agentId,
      userId,
      role: 'user',
      content: message,
    }),
    saveConversationMessage({
      agentId,
      userId,
      role: 'assistant',
      content: finalResponse,
      metadata: { toolsUsed },
    }),
    analyzeAndLearn(agentId, userId, message, finalResponse),
  ]).catch(err => console.error('Memory save error:', err))

  // 3. ê´€ê³„ ì¶”ì 
  processConversation({
    agentId,
    userId,
    messages: [
      { role: 'user', content: message },
      { role: 'assistant', content: finalResponse },
    ],
  }).catch(err => console.error('Relationship error:', err))
}
```

---

## 17. ë¬¸ì„œ (Source of Truth)

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| **`docs/agent-os-prd-v2.md`** | ë©”ì¸ ì‹œìŠ¤í…œ ìŠ¤í™ (4ëŒ€ ì—”ì§„, ë©”ëª¨ë¦¬, ì›Œí¬í”Œë¡œìš°) |
| `docs/PRD_OPENCLAW_INTEGRATION.md` | OpenClaw í†µí•© PRD |
| `docs/agent-memory-system-prd.md` | 5ê³„ì¸µ ë©”ëª¨ë¦¬ ì•„í‚¤í…ì²˜ |
| `docs/neuramap/` | Neural Map ì „ì²´ ìŠ¤í™ (12ê°œ íŒŒì¼) |
| `docs/NODE_BASED_AI_AGENT_ROADMAP.md` | Phase â†’ Epic â†’ Node ê³„ì¸µ |

---

## 18. ìì£¼ ì“°ëŠ” íŒ¨í„´ ìš”ì•½

### Import
```typescript
import { createClient } from '@/lib/supabase/server'
import { createAdminClient } from '@/lib/supabase/admin'
import { DynamicStructuredTool } from '@langchain/core/tools'
import { z } from 'zod'
import type { DeployedAgent, AgentMemory, ProjectTask } from '@/types/database'
```

### API ë¼ìš°íŠ¸
```typescript
export const dynamic = 'force-dynamic'

export async function GET/POST/PUT/DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  const { id } = await params
  // ...
}
```

### ì‘ë‹µ
```typescript
return NextResponse.json(data)                          // ì„±ê³µ
return NextResponse.json({ error: msg }, { status })    // ì—ëŸ¬
```

---

## 19. ì—­í• 

ë‹¹ì‹ ì€ **Builder/Executor**ì…ë‹ˆë‹¤.

**Source of Truth**: `docs/agent-os-prd-v2.md`

**í•µì‹¬ ì›ì¹™**:
1. ê¸°ì¡´ íŒ¨í„´ì„ ë”°ë¥¼ ê²ƒ
2. íƒ€ì…ì„ ëª…ì‹œí•  ê²ƒ
3. ì—ëŸ¬ë¥¼ ì ì ˆíˆ ì²˜ë¦¬í•  ê²ƒ
4. SupabaseëŠ” adminClientë¡œ RLS ìš°íšŒ ê°€ëŠ¥

---

## 20. OpenClaw í†µí•© (í–¥í›„)

GlowUS = OpenClawì˜ "ì ‘ì‹œ(Plate)"
- OpenClaw: ì‹¤í–‰ (ë¡œì»¬ PC ì œì–´)
- GlowUS: ì¡°ì§ (ë©”ëª¨ë¦¬, ê¶Œí•œ, ë¹„ìš© ì œì–´)

ìì„¸í•œ ë‚´ìš©: `docs/PRD_OPENCLAW_INTEGRATION.md`
