<!DOCTYPE html>
<html>
<head>
    <title>Electron IPC Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .result { background: #2d2d2d; padding: 15px; margin: 10px 0; border-left: 3px solid #007acc; }
        .error { border-left-color: #f44747; }
        .success { border-left-color: #4ec9b0; }
        pre { overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” Electron IPC ì‹¤ì œ ì‘ë™ í…ŒìŠ¤íŠ¸</h1>

    <div>
        <button onclick="testElectronExists()">1. window.electron ì¡´ì¬ í™•ì¸</button>
        <button onclick="testSelectDirectory()">2. í´ë” ì„ íƒ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testScanProject()">3. í”„ë¡œì íŠ¸ ìŠ¤ìº” í…ŒìŠ¤íŠ¸</button>
    </div>

    <div id="output"></div>

    <script>
        function log(message, isError = false) {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = 'result ' + (isError ? 'error' : 'success');
            div.innerHTML = message;
            output.appendChild(div);
        }

        function testElectronExists() {
            log('=== window.electron í™•ì¸ ===');
            if (window.electron) {
                log('âœ… window.electron ì¡´ì¬í•¨');
                log('ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì„œë“œ:<br>' +
                    'fs: ' + (window.electron.fs ? 'âœ…' : 'âŒ') + '<br>' +
                    'git: ' + (window.electron.git ? 'âœ…' : 'âŒ'));
            } else {
                log('âŒ window.electron ì—†ìŒ - Electron ì•±ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”', true);
            }
        }

        async function testSelectDirectory() {
            log('=== í´ë” ì„ íƒ í…ŒìŠ¤íŠ¸ ===');
            if (!window.electron || !window.electron.fs) {
                log('âŒ window.electron.fs ì—†ìŒ', true);
                return;
            }

            try {
                const result = await window.electron.fs.selectDirectory();
                if (result) {
                    log('âœ… í´ë” ì„ íƒ ì„±ê³µ:<br>' +
                        'name: ' + result.name + '<br>' +
                        'path: ' + result.path + '<br>' +
                        'kind: ' + result.kind);
                    window.selectedPath = result.path;
                } else {
                    log('âŒ í´ë” ì„ íƒ ì·¨ì†Œë¨');
                }
            } catch (error) {
                log('âŒ ì—ëŸ¬: ' + error.message, true);
            }
        }

        async function testScanProject() {
            log('=== í”„ë¡œì íŠ¸ ìŠ¤ìº” í…ŒìŠ¤íŠ¸ ===');

            if (!window.selectedPath) {
                log('âš ï¸  ë¨¼ì € "í´ë” ì„ íƒ í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”');
                return;
            }

            const path = window.selectedPath;
            log('ğŸ“‚ ìŠ¤ìº” ê²½ë¡œ: ' + path);

            try {
                // 1. File Stats
                log('<br>1ï¸âƒ£ File Stats í…ŒìŠ¤íŠ¸...');
                const stats = await window.electron.fs.fileStats(path);
                log('âœ… File Stats: ' + stats.length + 'ê°œ íŒŒì¼ ì°¾ìŒ<br>' +
                    '<pre>' + JSON.stringify(stats.slice(0, 3), null, 2) + '</pre>');

                // 2. Git Log
                log('<br>2ï¸âƒ£ Git Log í…ŒìŠ¤íŠ¸...');
                const gitLog = await window.electron.git.log(path, { maxCommits: 5 });
                log('âœ… Git Log ê°€ì ¸ì˜´<br>' +
                    '<pre>' + gitLog.substring(0, 500) + '...</pre>');

                // 3. API Routes
                log('<br>3ï¸âƒ£ API Routes ìŠ¤ìº”...');
                const routes = await window.electron.fs.scanApiRoutes(path);
                log('âœ… API Routes: ' + routes.length + 'ê°œ ì°¾ìŒ<br>' +
                    '<pre>' + JSON.stringify(routes.slice(0, 3), null, 2) + '</pre>');

                // 4. TypeScript Types
                log('<br>4ï¸âƒ£ TypeScript Types ìŠ¤ìº”...');
                const types = await window.electron.fs.scanTypes(path);
                log('âœ… Types: ' + types.length + 'ê°œ ì°¾ìŒ<br>' +
                    '<pre>' + JSON.stringify(types.slice(0, 3), null, 2) + '</pre>');

                // 5. Database Schema
                log('<br>5ï¸âƒ£ Database Schema ìŠ¤ìº”...');
                const schema = await window.electron.fs.scanSchema(path);
                log('âœ… Schema: ' + schema.length + 'ê°œ í…Œì´ë¸” ì°¾ìŒ<br>' +
                    '<pre>' + JSON.stringify(schema.slice(0, 3), null, 2) + '</pre>');

                log('<br>ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì„±ê³µ! IPCê°€ ì œëŒ€ë¡œ ì‘ë™í•©ë‹ˆë‹¤.');

            } catch (error) {
                log('âŒ ì—ëŸ¬ ë°œìƒ: ' + error.message + '<br>' +
                    '<pre>' + error.stack + '</pre>', true);
            }
        }
    </script>
</body>
</html>
