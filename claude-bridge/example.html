<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monaco + Claude Code</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1e1e1e;
      color: #d4d4d4;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: #252526;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #3c3c3c;
    }

    .header h1 {
      font-size: 16px;
      color: #fff;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #f44;
    }

    .status-dot.connected {
      background: #4f4;
    }

    .main {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    .editor-container {
      flex: 1;
      min-width: 0;
    }

    .panel {
      width: 400px;
      background: #252526;
      border-left: 1px solid #3c3c3c;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      padding: 10px 15px;
      background: #2d2d2d;
      border-bottom: 1px solid #3c3c3c;
      font-size: 13px;
      font-weight: 600;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      font-size: 13px;
      line-height: 1.6;
    }

    .panel-content code {
      background: #3c3c3c;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Fira Code', monospace;
    }

    .panel-content pre {
      background: #1e1e1e;
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 10px 0;
    }

    .panel-content pre code {
      background: none;
      padding: 0;
    }

    .panel-input {
      padding: 10px;
      border-top: 1px solid #3c3c3c;
      display: flex;
      gap: 8px;
    }

    .panel-input input {
      flex: 1;
      background: #3c3c3c;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      color: #fff;
      font-size: 13px;
    }

    .panel-input input:focus {
      outline: 1px solid #007acc;
    }

    .panel-input button {
      background: #007acc;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }

    .panel-input button:hover {
      background: #005a9e;
    }

    .panel-input button:disabled {
      background: #555;
      cursor: not-allowed;
    }

    .shortcuts {
      padding: 10px 15px;
      background: #2d2d2d;
      border-top: 1px solid #3c3c3c;
      font-size: 11px;
      color: #888;
    }

    .shortcuts kbd {
      background: #3c3c3c;
      padding: 2px 6px;
      border-radius: 3px;
      margin: 0 2px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Monaco Editor + Claude Code</h1>
    <div class="status">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">ì—°ê²° í™•ì¸ ì¤‘...</span>
    </div>
  </div>

  <div class="main">
    <div class="editor-container" id="editor"></div>
    
    <div class="panel">
      <div class="panel-header">Claude ì‘ë‹µ</div>
      <div class="panel-content" id="output">
        <p>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”! Claude Codeì™€ ì—°ë™ëœ ì—ë””í„°ì…ë‹ˆë‹¤.</p>
        <br>
        <p><strong>ì‚¬ìš© ë°©ë²•:</strong></p>
        <p>1. ì½”ë“œë¥¼ ì„ íƒí•˜ê³  ìš°í´ë¦­í•˜ë©´ Claude ë©”ë‰´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
        <p>2. ë˜ëŠ” ì•„ë˜ ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</p>
        <p>3. ì•„ë˜ ì…ë ¥ì°½ì— ì§ì ‘ ì§ˆë¬¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
      <div class="panel-input">
        <input type="text" id="promptInput" placeholder="Claudeì—ê²Œ ì§ˆë¬¸í•˜ê¸°..." />
        <button id="sendBtn">ì „ì†¡</button>
      </div>
      <div class="shortcuts">
        <kbd>Cmd+Shift+C</kbd> ì§ˆë¬¸ &nbsp;
        <kbd>Cmd+Shift+E</kbd> ì„¤ëª… &nbsp;
        <kbd>Cmd+Shift+R</kbd> ë¦¬íŒ©í† ë§
      </div>
    </div>
  </div>

  <!-- Monaco Editor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
  
  <!-- Claude Client & Plugin -->
  <script src="claude-web-client.js"></script>
  <script src="monaco-claude-plugin.js"></script>

  <script>
    // Monaco Editor ë¡œë“œ
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } });

    require(['vs/editor/editor.main'], function () {
      // ì—ë””í„° ìƒì„±
      const editor = monaco.editor.create(document.getElementById('editor'), {
        value: `// ì˜ˆì‹œ ì½”ë“œ
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

// 10ë²ˆì§¸ í”¼ë³´ë‚˜ì¹˜ ìˆ˜ ì¶œë ¥
console.log(fibonacci(10));
`,
        language: 'javascript',
        theme: 'vs-dark',
        fontSize: 14,
        minimap: { enabled: false },
        automaticLayout: true
      });

      // Claude í´ë¼ì´ì–¸íŠ¸ ìƒì„±
      const claude = new ClaudeClient({
        bridgeUrl: 'http://localhost:3333',
        onError: (e) => console.error('Claude Error:', e)
      });

      // Monaco Plugin ì—°ê²°
      const plugin = new MonacoClaudePlugin(editor, {
        monaco: monaco,
        claudeClient: claude,
        panelContainer: document.getElementById('output'),
        onOutput: (text, isStreaming) => {
          document.getElementById('output').innerHTML = formatMarkdown(text);
        }
      });

      // ì—°ê²° ìƒíƒœ í™•ì¸
      async function checkStatus() {
        const status = await claude.checkConnection();
        const dot = document.getElementById('statusDot');
        const text = document.getElementById('statusText');
        
        if (status.connected) {
          dot.classList.add('connected');
          text.textContent = 'Bridge ì—°ê²°ë¨';
        } else {
          dot.classList.remove('connected');
          text.textContent = 'Bridge ì—°ê²° ì•ˆë¨ - ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”';
        }
      }
      
      checkStatus();
      setInterval(checkStatus, 5000);

      // ì…ë ¥ì°½ ì´ë²¤íŠ¸
      const input = document.getElementById('promptInput');
      const sendBtn = document.getElementById('sendBtn');

      async function sendPrompt() {
        const prompt = input.value.trim();
        if (!prompt) return;

        input.value = '';
        sendBtn.disabled = true;

        await plugin.ask(prompt);
        
        sendBtn.disabled = false;
      }

      sendBtn.addEventListener('click', sendPrompt);
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendPrompt();
      });

      // ë§ˆí¬ë‹¤ìš´ í¬ë§·íŒ…
      function formatMarkdown(text) {
        return text
          .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code class="language-$1">$2</code></pre>')
          .replace(/`([^`]+)`/g, '<code>$1</code>')
          .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
          .replace(/\n/g, '<br>');
      }
    });
  </script>
</body>
</html>
